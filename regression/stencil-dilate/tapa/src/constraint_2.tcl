puts "applying partitioning constraints generated by tapac"
write_checkpoint before_add_floorplan_constraints.dcp

# begin defining a slot
create_pblock CR_X4Y4_To_CR_X7Y7
resize_pblock CR_X4Y4_To_CR_X7Y7 -add CLOCKREGION_X4Y4:CLOCKREGION_X7Y7
# remove the reserved clock regions for the Vitis infra
resize_pblock CR_X4Y4_To_CR_X7Y7 -remove CLOCKREGION_X7Y1:CLOCKREGION_X7Y11


# begin defining a slot
create_pblock CR_X0Y0_To_CR_X3Y3
resize_pblock CR_X0Y0_To_CR_X3Y3 -add CLOCKREGION_X0Y0:CLOCKREGION_X3Y3
# remove the reserved clock regions for the Vitis infra
resize_pblock CR_X0Y0_To_CR_X3Y3 -remove CLOCKREGION_X7Y1:CLOCKREGION_X7Y11


# begin defining a slot
create_pblock CR_X4Y0_To_CR_X7Y3
resize_pblock CR_X4Y0_To_CR_X7Y3 -add CLOCKREGION_X4Y0:CLOCKREGION_X7Y3
# remove the reserved clock regions for the Vitis infra
resize_pblock CR_X4Y0_To_CR_X7Y3 -remove CLOCKREGION_X7Y1:CLOCKREGION_X7Y11

add_cells_to_pblock [get_pblocks pblock_dynamic_SLR0] [get_cells -regex {
  pfm_top_i/dynamic_region/.*/inst/.*/control_s_axi_U_slr_0
  pfm_top_i/dynamic_region/.*/inst/.*/tapa_state.*
} ]
add_cells_to_pblock [get_pblocks pblock_dynamic_SLR1] [get_cells -regex {
  pfm_top_i/dynamic_region/.*/inst/.*/control_s_axi_U_slr_1
} ]
add_cells_to_pblock [get_pblocks pblock_dynamic_SLR2] [get_cells -regex {
  pfm_top_i/dynamic_region/.*/inst/.*/control_s_axi_U_slr_2
} ]
add_cells_to_pblock [get_pblocks CR_X0Y0_To_CR_X3Y3] [get_cells -regex {
  pfm_top_i/dynamic_region/.*/inst/.*/DILATE_0
  pfm_top_i/dynamic_region/.*/inst/.*/DILATE_0__state.*
  pfm_top_i/dynamic_region/.*/inst/.*/DILATE_2
  pfm_top_i/dynamic_region/.*/inst/.*/DILATE_2__state.*
  pfm_top_i/dynamic_region/.*/inst/.*/DILATE_3
  pfm_top_i/dynamic_region/.*/inst/.*/DILATE_3__state.*
  pfm_top_i/dynamic_region/.*/inst/.*/DILATE_6
  pfm_top_i/dynamic_region/.*/inst/.*/DILATE_6__state.*
  pfm_top_i/dynamic_region/.*/inst/.*/Stream2Mmap_0
  pfm_top_i/dynamic_region/.*/inst/.*/Stream2Mmap_0__state.*
  pfm_top_i/dynamic_region/.*/inst/.*/k_rd_10/inst\\[1]\\.unit
  pfm_top_i/dynamic_region/.*/inst/.*/k_rd_13/inst\\[1]\\.unit
  pfm_top_i/dynamic_region/.*/inst/.*/k_rd_9/inst\\[1]\\.unit
  pfm_top_i/dynamic_region/.*/inst/.*/k_wr_10/inst\\[0]\\.unit
  pfm_top_i/dynamic_region/.*/inst/.*/k_wr_13/inst\\[0]\\.unit
  pfm_top_i/dynamic_region/.*/inst/.*/k_wr_7/.*.unit
  pfm_top_i/dynamic_region/.*/inst/.*/k_wr_9/inst\\[0]\\.unit
} ]
add_cells_to_pblock [get_pblocks CR_X4Y4_To_CR_X7Y7] [get_cells -regex {
  pfm_top_i/dynamic_region/.*/inst/.*/DILATE_1
  pfm_top_i/dynamic_region/.*/inst/.*/DILATE_1__state.*
  pfm_top_i/dynamic_region/.*/inst/.*/DILATE_4
  pfm_top_i/dynamic_region/.*/inst/.*/DILATE_4__state.*
  pfm_top_i/dynamic_region/.*/inst/.*/DILATE_5
  pfm_top_i/dynamic_region/.*/inst/.*/DILATE_5__state.*
  pfm_top_i/dynamic_region/.*/inst/.*/DILATE_7
  pfm_top_i/dynamic_region/.*/inst/.*/DILATE_7__state.*
  pfm_top_i/dynamic_region/.*/inst/.*/k_rd_11/inst\\[1]\\.unit
  pfm_top_i/dynamic_region/.*/inst/.*/k_rd_12/inst\\[1]\\.unit
  pfm_top_i/dynamic_region/.*/inst/.*/k_rd_14/inst\\[1]\\.unit
  pfm_top_i/dynamic_region/.*/inst/.*/k_rd_8/inst\\[1]\\.unit
  pfm_top_i/dynamic_region/.*/inst/.*/k_wr_11/inst\\[0]\\.unit
  pfm_top_i/dynamic_region/.*/inst/.*/k_wr_12/inst\\[0]\\.unit
  pfm_top_i/dynamic_region/.*/inst/.*/k_wr_14/inst\\[0]\\.unit
  pfm_top_i/dynamic_region/.*/inst/.*/k_wr_8/inst\\[0]\\.unit
} ]
add_cells_to_pblock [get_pblocks CR_X4Y0_To_CR_X7Y3] [get_cells -regex {
  pfm_top_i/dynamic_region/.*/inst/.*/Mmap2Stream_0
  pfm_top_i/dynamic_region/.*/inst/.*/Mmap2Stream_0__state.*
  pfm_top_i/dynamic_region/.*/inst/.*/inter_kernel_0
  pfm_top_i/dynamic_region/.*/inst/.*/inter_kernel_0__state.*
  pfm_top_i/dynamic_region/.*/inst/.*/inter_kernel_1
  pfm_top_i/dynamic_region/.*/inst/.*/inter_kernel_1__state.*
  pfm_top_i/dynamic_region/.*/inst/.*/inter_kernel_2
  pfm_top_i/dynamic_region/.*/inst/.*/inter_kernel_2__state.*
  pfm_top_i/dynamic_region/.*/inst/.*/inter_kernel_3
  pfm_top_i/dynamic_region/.*/inst/.*/inter_kernel_3__state.*
  pfm_top_i/dynamic_region/.*/inst/.*/inter_kernel_4
  pfm_top_i/dynamic_region/.*/inst/.*/inter_kernel_4__state.*
  pfm_top_i/dynamic_region/.*/inst/.*/inter_kernel_5
  pfm_top_i/dynamic_region/.*/inst/.*/inter_kernel_5__state.*
  pfm_top_i/dynamic_region/.*/inst/.*/inter_kernel_6
  pfm_top_i/dynamic_region/.*/inst/.*/inter_kernel_6__state.*
  pfm_top_i/dynamic_region/.*/inst/.*/in_8__m_axi
  pfm_top_i/dynamic_region/.*/inst/.*/in_8__m_axi__state.*
  pfm_top_i/dynamic_region/.*/inst/.*/out_8__m_axi
  pfm_top_i/dynamic_region/.*/inst/.*/out_8__m_axi__state.*
  pfm_top_i/dynamic_region/.*/inst/.*/in_9__m_axi
  pfm_top_i/dynamic_region/.*/inst/.*/in_9__m_axi__state.*
  pfm_top_i/dynamic_region/.*/inst/.*/out_9__m_axi
  pfm_top_i/dynamic_region/.*/inst/.*/out_9__m_axi__state.*
  pfm_top_i/dynamic_region/.*/inst/.*/in_10__m_axi
  pfm_top_i/dynamic_region/.*/inst/.*/in_10__m_axi__state.*
  pfm_top_i/dynamic_region/.*/inst/.*/out_10__m_axi
  pfm_top_i/dynamic_region/.*/inst/.*/out_10__m_axi__state.*
  pfm_top_i/dynamic_region/.*/inst/.*/in_11__m_axi
  pfm_top_i/dynamic_region/.*/inst/.*/in_11__m_axi__state.*
  pfm_top_i/dynamic_region/.*/inst/.*/out_11__m_axi
  pfm_top_i/dynamic_region/.*/inst/.*/out_11__m_axi__state.*
  pfm_top_i/dynamic_region/.*/inst/.*/in_12__m_axi
  pfm_top_i/dynamic_region/.*/inst/.*/in_12__m_axi__state.*
  pfm_top_i/dynamic_region/.*/inst/.*/out_12__m_axi
  pfm_top_i/dynamic_region/.*/inst/.*/out_12__m_axi__state.*
  pfm_top_i/dynamic_region/.*/inst/.*/in_13__m_axi
  pfm_top_i/dynamic_region/.*/inst/.*/in_13__m_axi__state.*
  pfm_top_i/dynamic_region/.*/inst/.*/out_13__m_axi
  pfm_top_i/dynamic_region/.*/inst/.*/out_13__m_axi__state.*
  pfm_top_i/dynamic_region/.*/inst/.*/in_14__m_axi
  pfm_top_i/dynamic_region/.*/inst/.*/in_14__m_axi__state.*
  pfm_top_i/dynamic_region/.*/inst/.*/out_14__m_axi
  pfm_top_i/dynamic_region/.*/inst/.*/out_14__m_axi__state.*
  pfm_top_i/dynamic_region/.*/inst/.*/k_rd_10/inst\\[0]\\.unit
  pfm_top_i/dynamic_region/.*/inst/.*/k_rd_11/inst\\[0]\\.unit
  pfm_top_i/dynamic_region/.*/inst/.*/k_rd_12/inst\\[0]\\.unit
  pfm_top_i/dynamic_region/.*/inst/.*/k_rd_13/inst\\[0]\\.unit
  pfm_top_i/dynamic_region/.*/inst/.*/k_rd_14/inst\\[0]\\.unit
  pfm_top_i/dynamic_region/.*/inst/.*/k_rd_8/inst\\[0]\\.unit
  pfm_top_i/dynamic_region/.*/inst/.*/k_rd_9/inst\\[0]\\.unit
  pfm_top_i/dynamic_region/.*/inst/.*/k_wr_10/inst\\[1]\\.unit
  pfm_top_i/dynamic_region/.*/inst/.*/k_wr_11/inst\\[1]\\.unit
  pfm_top_i/dynamic_region/.*/inst/.*/k_wr_12/inst\\[1]\\.unit
  pfm_top_i/dynamic_region/.*/inst/.*/k_wr_13/inst\\[1]\\.unit
  pfm_top_i/dynamic_region/.*/inst/.*/k_wr_14/inst\\[1]\\.unit
  pfm_top_i/dynamic_region/.*/inst/.*/k_wr_8/inst\\[1]\\.unit
  pfm_top_i/dynamic_region/.*/inst/.*/k_wr_9/inst\\[1]\\.unit
} ]
add_cells_to_pblock [get_pblocks CR_X0Y0_To_CR_X3Y3] [get_cells -regex {
  pfm_top_i/dynamic_region/.*/inst/temp/R_pipeline/inst\\[0]\\.unit
  pfm_top_i/dynamic_region/.*/inst/temp/B_pipeline/inst\\[0]\\.unit
} ]
add_cells_to_pblock [get_pblocks CR_X4Y0_To_CR_X7Y3] [get_cells -regex {
  pfm_top_i/dynamic_region/.*/inst/temp/AR_pipeline/inst\\[0]\\.unit
  pfm_top_i/dynamic_region/.*/inst/temp/AW_pipeline/inst\\[0]\\.unit
  pfm_top_i/dynamic_region/.*/inst/temp/W_pipeline/inst\\[0]\\.unit
} ]
foreach pblock [get_pblocks -regexp CR_X\\d+Y\\d+_To_CR_X\\d+Y\\d+] {
  if {[get_property CELL_COUNT $pblock] == 0} {
    puts "WARNING: delete empty pblock $pblock "
    delete_pblocks $pblock
  }
}
foreach pblock [get_pblocks] {
  report_utilization -pblocks $pblock
}