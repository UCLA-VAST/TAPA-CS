puts "applying partitioning constraints generated by tapac"
write_checkpoint before_add_floorplan_constraints.dcp

# begin defining a slot
create_pblock CR_X0Y0_To_CR_X3Y3
resize_pblock CR_X0Y0_To_CR_X3Y3 -add CLOCKREGION_X0Y0:CLOCKREGION_X3Y3
# remove the reserved clock regions for the Vitis infra
resize_pblock CR_X0Y0_To_CR_X3Y3 -remove CLOCKREGION_X7Y1:CLOCKREGION_X7Y11

add_cells_to_pblock [get_pblocks pblock_dynamic_SLR0] [get_cells -regex {
  pfm_top_i/dynamic_region/.*/inst/.*/control_s_axi_U_slr_0
  pfm_top_i/dynamic_region/.*/inst/.*/tapa_state.*
} ]
add_cells_to_pblock [get_pblocks pblock_dynamic_SLR1] [get_cells -regex {
  pfm_top_i/dynamic_region/.*/inst/.*/control_s_axi_U_slr_1
} ]
add_cells_to_pblock [get_pblocks pblock_dynamic_SLR2] [get_cells -regex {
  pfm_top_i/dynamic_region/.*/inst/.*/control_s_axi_U_slr_2
} ]
add_cells_to_pblock [get_pblocks CR_X0Y0_To_CR_X3Y3] [get_cells -regex {
  pfm_top_i/dynamic_region/.*/inst/.*/Add_0
  pfm_top_i/dynamic_region/.*/inst/.*/Add_0__state.*
  pfm_top_i/dynamic_region/.*/inst/.*/Mmap2Stream_0
  pfm_top_i/dynamic_region/.*/inst/.*/Mmap2Stream_0__state.*
  pfm_top_i/dynamic_region/.*/inst/.*/Mmap2Stream_1
  pfm_top_i/dynamic_region/.*/inst/.*/Mmap2Stream_1__state.*
  pfm_top_i/dynamic_region/.*/inst/.*/Stream2Mmap_0
  pfm_top_i/dynamic_region/.*/inst/.*/Stream2Mmap_0__state.*
  pfm_top_i/dynamic_region/.*/inst/.*/a_q/.*.unit
  pfm_top_i/dynamic_region/.*/inst/.*/b_q/.*.unit
  pfm_top_i/dynamic_region/.*/inst/.*/c_q/.*.unit
} ]
foreach pblock [get_pblocks -regexp CR_X\\d+Y\\d+_To_CR_X\\d+Y\\d+] {
  if {[get_property CELL_COUNT $pblock] == 0} {
    puts "WARNING: delete empty pblock $pblock "
    delete_pblocks $pblock
  }
}
foreach pblock [get_pblocks] {
  report_utilization -pblocks $pblock
}
get_clock_regions