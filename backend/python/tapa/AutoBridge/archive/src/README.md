# Description

`graph.py` is the center of the tool. It analyze the top RTL file of the design and construct a graph representation of the design. It then invokes the floorplanner to assign each module to one unique slot. Based on the floorplanning, the FIFOs will be replaced by the `relay_station` template to allow easy adjustment of pipeline level. Finally, the modified top RTL file and the corresponding floorplan script will be generated.

`assign_slr.py` performs the floorplanning and the rebalancing of reconvergent paths. Currently the 2-way partitioning has not been generalized to arbitrary grids and it only supports the 2-column-4-row format for U250 and the 2-column-3-row format for U280. We are currently developing new methods to extend AutoBridge for more fine-grained floorplanning.


`formator.py` handls most tool-specific details. It mostly contains the resource information of the target FPGA; routines to extract information from the top RTL file based on the coding sytle of HLS-generated RTL, etc.

`autopilot_parser.py` provides APIs to parse various reports generated by Vivado HLS.

`my_generator.py` contains methods to produce the new RTL top file and the floorplan scripts. 

- The constraint generator will separately produce the floorplan constraints for different structures (e.g., modules, FIFO connections, pipeline registers). In addition to the components visible from the HLS source code, it also produces floorplan constraints for the implicit control logic that is automatically generated by HLS (e.g., start/reset/done signals, AXI interface modules).

- As the resource distribution in Xilinx FPGAs are highly irregular, we have to hard-code the location and boundary of each target floorplan region. We are still thinking about methods to solve this issue.

- The RTL generator will replace the FIFO units by our own almost-full FIFO templates that can be easily pipelined. It will also mark various RTL components to prevent Vivado from unwanted optimization. 


`optimize_control_signals.py` will create a unique copy of the control signals (ap_start, ap_done, etc) and adequately pipeline them to avoid high fanout or timing violation on these signals. Such modification is highly dependent on the coding style of HLS-generated RTL. The current implementation is based on the coding style with 
```c++
  #pragma HLS dataflow disable_start_propagation
```



# Issues

- The current implementation is relatively messy as it results from countless trial-and-error and a pressing submission deadline. We are in progress to refactor the code. Currently our goals include: 
  * Enabling easy adaptation to different FPGA devices.
  * Enabling more fine-grained floorplanning.
 